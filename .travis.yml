os:
  - linux

dist:  bionic

language: php

php:
  - '7.3'

services:
  - docker

addons:
  hosts:
    - tabrasa8.ifdev

env:
  - COMPOSER_MEMORY_LIMIT=-1

git:
  depth: false

notifications:
  email:
    - lisa@ifsight.com
  on_success: change
  on_failure: always

before_install:
  - export PATH=$PATH:$HOME/.local/bin
  - sudo apt-get -qq update
  - sudo apt-get install -y pv
  # Removing AWS CLI install for now, may need later
  #- curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
  #- unzip awscli-bundle.zip
  #- ./awscli-bundle/install -b ~/bin/aws
  #- rm -Rf awscli-bundle.zip
  #- rm -Rf awscli-bundle
  # Adding bin path to global path to support post-composer build process and finding binaries for testing purposes
  - export PATH=~/bin:$PATH
  - mkdir -p ~/shared
  - docker-compose pull

before_script:
  # initial composer build process
  - composer install
  - cd ./docroot/sites/default
  - curl -O https://git.drupalcode.org/project/drupal/-/raw/8.8.x/sites/default/default.settings.php
  - cd ../../..
  - docker-compose up -d --build
  - docker-compose ps
  - sudo chmod a+w docroot/sites/default/files
  - sleep 15
#  - docker-compose exec php7.3 /bin/sh -c "cd /var/www/html/docroot; ../bin/drush site:install --db-url=mysql://drupal:drupal@db/drupal --account-name='admin' --account-pass='admin' --account-mail='ifdrupaladmin@ifsight.net' --site-name='Tabula Rasa 8' --site-mail='ifdrupaladmin@ifsight.net' -y"
#  - docker-compose exec php7.3 /bin/sh -c "cd /var/www/html/docroot; ../bin/drush cr"

script:
#  - ./d9-readiness-test-cobb.sh

